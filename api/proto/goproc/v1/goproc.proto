syntax = "proto3";

package goproc.v1;

option go_package = "goproc/api/proto/goproc/v1;goprocv1";

// Base service for daemon control/queries. Minimal now: Ping/Add/List/Kill/Rm.
// We'll evolve messages later (tags, metrics, etc.).
service GoProc {
  rpc Ping (PingRequest) returns (PingResponse);
  rpc Add  (AddRequest)  returns (AddResponse);
  rpc List (ListRequest) returns (ListResponse);
  rpc Kill (KillRequest) returns (KillResponse);
  rpc Rm   (RmRequest)   returns (RmResponse);
  rpc RenameTag   (RenameTagRequest)   returns (RenameTagResponse);
  rpc RenameGroup (RenameGroupRequest) returns (RenameGroupResponse);
  rpc Reset (ResetRequest) returns (ResetResponse);
}

message PingRequest {}
message PingResponse { string ok = 1; } // "pong"

message AddRequest  {
  int32 pid = 1;         // MVP: just a PID
  repeated string tags = 2;
  repeated string groups = 3;
}
message AddResponse { uint64 id = 1; }         // internal id

message ListRequest {
  repeated uint64 ids = 1;
  repeated int32 pids = 2;
  repeated string tags_any = 3;
  repeated string tags_all = 4;
  repeated string groups_any = 5;
  repeated string groups_all = 6;
  bool alive_only = 7;
  string text_search = 8;
}
message Proc {
  uint64 id  = 1;
  int32  pid = 2;
  int32  pgid = 3;
  string cmd = 4;
  bool   alive = 5;
  repeated string tags = 6;
  repeated string groups = 7;
  int64 added_at_unix = 8;
  int64 last_seen_unix = 9;
  // Metrics will be added later (cpu%, rss, io)
}
message ListResponse { repeated Proc procs = 1; }

message KillRequest { oneof target { uint64 id = 1; int32 pid = 2; } }
message KillResponse {}

message RmRequest   { uint64 id = 1; }
message RmResponse  {}

message RenameTagRequest   { string from = 1; string to = 2; }
message RenameTagResponse  { uint32 updated = 1; }
message RenameGroupRequest { string from = 1; string to = 2; }
message RenameGroupResponse { uint32 updated = 1; }
message ResetRequest {}
message ResetResponse {}
